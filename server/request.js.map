{"version":3,"file":"request.js","sourceRoot":"/Users/mjong/Development/AppDOM/src/","sources":["server/request.ts"],"names":[],"mappings":"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","sourcesContent":["import {Callback, callback, Calledback} from './callback';\n\ntype dictionaryString = {[key: string]: string};\n\nexport class Request {\n  headers : dictionaryString = {};\n  payload : any = null;\n  params : dictionaryString = {};\n  query : dictionaryString = {};\n  path : string|null = null;\n  method : string|null = null;\n  body : string|null = null;\n\n  stageVariables: any;\n  requestContext: any;\n\n  event: any;\n  context: any;\n\n  constructor(event: any, context: any) {\n    this.path = event.path;\n    this.method = event.httpMethod;\n    this.headers = event.headers;\n    this.params = event.pathParameters;\n    this.query = event.queryStringParameters;\n    this.body = event.body;\n\n    this.stageVariables = event.stageVariables;\n    this.requestContext = event.requestContext;\n\n    this.event = event;\n    this.context = context;\n\n    if (typeof event.body === 'string') {\n\n      try {\n        this.payload = JSON.parse(event.body);\n      } catch(e) {\n        //TODO warn about error\n      }\n    }\n  }\n}\n\nexport class Response {\n  _callback: callback;\n  _statusCode: number = 200;\n  _headers: dictionaryString;\n  _body: string;\n\n  constructor(cb: callback) {\n    this._callback = Callback(cb);\n  }\n\n  set body(val: object | string) {\n    if (typeof val === 'string') {\n      this._body = val;\n    } else if (typeof val === 'object') {\n      this._body = JSON.stringify(val);\n    }\n  }\n\n  set statusCode(val: number) {\n    if (typeof val === 'number') {\n      this._statusCode = Math.floor(val);\n    }\n  }\n\n  set headers(val: dictionaryString) {\n    if (typeof val === 'object') {\n      this._headers = val;\n    }\n  }\n\n  setHeader(key: string, val: string) {\n    if (typeof val === 'string') {\n      this._headers[key] = val;\n    }\n  }\n\n  removeHeader(key: string) {\n    delete this._headers[key]\n  }\n\n  send(statusCode?: number, body?: object|string, headers?: dictionaryString) : Calledback {\n    if (body) this.body = body;\n    if (headers) this.headers = headers;\n    if (statusCode) this.statusCode = statusCode;\n\n    return this._callback(null, {\n      statusCode: this._statusCode,\n      headers: this._headers,\n      body: this._body,\n    });\n  }\n}\n\ntype handler = (req: Request, res: Response) => Calledback;\n\nexport function Handler(handler: handler) : (event: any, context: any, cb: callback) => Calledback {\n  return (event: any, context: any, cb: callback) => {\n    let request = new Request(event, context);\n    let response = new Response(cb);\n    try {\n      return handler(request, response);\n    } catch (e) {\n      return Callback(cb)(e, null);\n    }\n  }\n}\n"]}